<%= sidebar_turbo_frame_tag do %>
  <%= turbo_stream_from :rooms %>
  <%= turbo_stream_from current_campfire_user, :rooms %>

  <div class="sidebar__container overflow-y overflow-hide-scrollbar"
    data-controller="badge-dot"
    data-badge-dot-unread-class="unread"
    data-action="rooms-list:unread@window->badge-dot#update rooms-list:read@window->badge-dot#update turbo:submit-start->turbo-frame#unpermanize">
    <turbo-frame id="direct_rooms_control" target="_top">
      <div class="directs gap overflow-x overflow-hide-scrollbar">
        <%= link_to new_rooms_direct_path, class: "direct direct__new", data: { turbo_frame: "_self" } do %>
          <span class="avatar avatar--icon">
            <%= image_tag "campfire/messages-add.svg", size: 20, aria: { hidden: "true" }, class: "colorize--black" %>
          </span>

          <span class="direct__author flex max-width min-width border-radius pad-inline-half">
            <span class="for-screen-reader">New</span>
            <span class="txt-small overflow-clip">Ping</span>
          </span>
        <% end %>

        <div id="direct_rooms" contents data-controller="sorted-list" data-action="rooms-list:unread@window->sorted-list#updateItem">
          <%= render partial: "campfire/users/sidebars/rooms/direct", collection: @direct_memberships, as: :membership, cached: true %>
        </div>

        <div contents>
          <%= render partial: "campfire/users/sidebars/rooms/direct_placeholder", collection: @direct_placeholder_users, as: :user %>
        </div>
      </div>
    </turbo-frame>


    <div class="rooms position-relative flex flex-column gap">
      <div id="shared_rooms" contents data-controller="sorted-list">
        <% @other_memberships.each do |membership| %>
          <%= render "campfire/users/sidebars/rooms/shared", room: membership.room, unread: membership.unread? %>
        <% end %>
      </div>

      <%= link_to new_rooms_open_path, class: "rooms__new-btn btn room align-center gap txt-reversed", aria: { label: "New Chat Room" } do %>
        <%= image_tag "campfire/add.svg", size: 20, aria: { hidden: "true" }, style: "view-transition-name: new-room" %>
      <% end %>
    </div>
  </div>
<% end %>